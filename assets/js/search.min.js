document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("search-input"),t=document.getElementById("search-results"),s=document.querySelector('form[role="search"]');let n=[];function r(e){if(!t)return;if(!n.length)return void(t.innerHTML='<p class="text-warning">Search index is still loading. Please wait a moment and try again.</p>');const s=e.toLowerCase(),r=s.split(" ").filter(e=>e.length>0);!function(e,s){if(0===e.length)return void(t.innerHTML=`\n        <div class="search-no-results">\n          <h3>No results found for "${s}"</h3>\n          <p>Try different keywords or check your spelling.</p>\n          <div class="search-suggestions">\n            <p>Search suggestions:</p>\n            <ul>\n              <li>Use fewer keywords</li>\n              <li>Check spelling</li>\n              <li>Try related terms</li>\n              <li>Search for specific categories or tags</li>\n            </ul>\n          </div>\n        </div>\n      `);let n=`\n      <div class="search-results-header">\n        <h3>Found ${e.length} result${1!==e.length?"s":""} for "${s}"</h3>\n      </div>\n      <div class="search-results-list">\n    `;e.forEach(e=>{const t=e.url.startsWith("/")?e.url:"/"+e.url,r=e.excerpt||(e.content?e.content.substring(0,200)+"...":""),o=e.date||"",i=e.type||"post",c=a(e.title,s),l=a(r,s);n+=`\n        <div class="search-result-item">\n          <h4><a href="${t}">${c}</a></h4>\n          <p class="search-result-excerpt">${l}</p>\n          <div class="search-result-meta">\n            ${o?`<span class="search-result-date"><i class="feather" data-feather="calendar"></i> ${o}</span>`:""}\n            ${i?`<span class="search-result-type"><i class="feather" data-feather="file-text"></i> ${i}</span>`:""}\n            ${e.categories&&e.categories.length>0?`<span class="search-result-categories"><i class="feather" data-feather="folder"></i> ${e.categories.join(", ")}</span>`:""}\n            ${e.tags&&e.tags.length>0?`<span class="search-result-tags"><i class="feather" data-feather="tag"></i> ${e.tags.slice(0,3).join(", ")}</span>`:""}\n          </div>\n        </div>\n      `}),n+="</div>",t.innerHTML=n,"undefined"!=typeof feather&&feather.replace()}(n.map(e=>{let t=0;const n=e.title.toLowerCase(),a=e.content?e.content.toLowerCase():"",o=e.excerpt?e.excerpt.toLowerCase():"";return n.includes(s)&&(t+=50),n===s&&(t+=100),r.forEach(e=>{n.includes(e)&&(t+=25)}),a.includes(s)&&(t+=20),o.includes(s)&&(t+=15),e.categories&&e.categories.some(e=>e.toLowerCase().includes(s))&&(t+=30),e.tags&&e.tags.some(e=>e.toLowerCase().includes(s))&&(t+=25),r.forEach(e=>{a.includes(e)&&(t+=5)}),t>0?{...e,score:t}:null}).filter(e=>null!==e).sort((e,t)=>t.score-e.score),e)}function a(e,t){if(!e||!t)return e;const s=t.toLowerCase().split(" ").filter(e=>e.length>1);let n=e;return s.forEach(e=>{const t=new RegExp(`(${e})`,"gi");n=n.replace(t,"<mark>$1</mark>")}),n}fetch(function(){const e=document.querySelector('meta[name="base-url"]');return(e?e.content:"")||""}()+"/search.json").then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(s=>{if(Array.isArray(s)){n=s,console.log("Search index loaded:",n.length,"items");const t=new URLSearchParams(window.location.search).get("q");t&&e&&(e.value=t,r(t))}else console.error("Search data is not an array:",s),t&&(t.innerHTML='<p class="text-danger">Error loading search data. Please try again later.</p>')}).catch(e=>{console.error("Error loading search index:",e),t&&(t.innerHTML='<p class="text-danger">Error loading search data. Please try again later.</p>')}),s&&s.addEventListener("submit",function(t){t.preventDefault();const s=e?e.value.trim():"";if(s&&s.length>=2){r(s);const e=new URL(window.location);e.searchParams.set("q",s),window.history.pushState({},"",e)}else e&&e.focus()}),e&&!document.getElementById("live-search-results")&&e.addEventListener("input",function(){const e=this.value.trim();e.length>=2?r(e):t&&(t.innerHTML='<p class="search-instructions">Enter your search terms above to find content on this site.</p>')})});